# Making Docker Compose File
- name: Generate docker-compose.yml
  hosts: managers
  become: true
  vars_files:
    - ../group_vars/secrets/vault.yml
    - ../group_vars/all.yml
  tasks:
    - name: Generating docker-compose from template
      ansible.builtin.include_tasks: ../tasks/docker/13_copying_wazuh_compose_file.yml

# Generate the Indexers certs
- name: Run indexer certificate generator container
  hosts: managers
  become: true
  vars_files:
    - ../group_vars/all.yml
  tasks:
    - name: Generating Certfs
      ansible.builtin.include_tasks: ../tasks/docker/11_run_indexer_certificate_generator.yml

# Deploy Wazuh Docker stack
- name: Deploy Wazuh Docker stack
  hosts: managers
  become: true
  vars_files:
    - ../group_vars/all.yml
  tasks:
    - name: Deploying Wazuh multi node
      ansible.builtin.include_tasks: ../tasks/docker/12_deploy_wazuh_stack.yml
